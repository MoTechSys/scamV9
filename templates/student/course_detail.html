{% extends 'layouts/dashboard_base.html' %}
{% block title %}{{ course.course_code }}{% endblock %}
{% block page_title %}{{ course.course_code }} - {{ course.course_name }}{% endblock %}
{% block breadcrumb %}
<nav aria-label="breadcrumb"><ol class="breadcrumb breadcrumb-custom"><li class="breadcrumb-item"><a href="{% url 'student:course_list' %}">مقرراتي</a></li><li class="breadcrumb-item active">{{ course.course_code }}</li></ol></nav>
{% endblock %}
{% block dashboard_content %}
<!-- Course Info -->
<div class="d-flex gap-3 mb-3 small text-muted flex-wrap">
    <span class="d-inline-flex align-items-center gap-1"><i class="bi bi-person"></i>{% for ic in instructors %}{{ ic.instructor.full_name }}{% if not forloop.last %}، {% endif %}{% endfor %}</span>
    <span class="d-inline-flex align-items-center gap-1"><i class="bi bi-layer-forward"></i>{{ course.level }}</span>
    {% if all_files %}<span class="d-inline-flex align-items-center gap-1"><i class="bi bi-files"></i>{{ all_files.count }} ملف</span>{% endif %}
</div>

<!-- File Groups -->
{% for label, icon, files in file_groups %}
{% if files %}
<div class="card mb-3">
    <div class="card-header bg-transparent py-3"><h6 class="mb-0 fw-bold"><i class="bi {{ icon }} me-2"></i>{{ label }} ({{ files|length }})</h6></div>
    <div class="list-group list-group-flush">
        {% for file in files %}
        <div class="list-group-item py-3">
            <div class="d-flex justify-content-between align-items-center gap-2">
                <div class="d-flex align-items-center gap-2 min-w-0">
                    <i class="bi {% if file.is_pdf %}bi-file-earmark-pdf text-danger{% elif file.is_video %}bi-play-circle text-primary{% elif file.is_image %}bi-file-earmark-image text-success{% else %}bi-file-earmark text-secondary{% endif %} flex-shrink-0 fs-5"></i>
                    <div class="min-w-0">
                        <strong class="text-truncate d-block" style="font-size:0.9rem;">{{ file.title|truncatechars:40 }}</strong>
                        <small class="text-muted">{{ file.upload_date|date:"Y/m/d" }} | {{ file.file_extension|default:"-" }}</small>
                    </div>
                </div>
                <div class="d-flex gap-1 flex-shrink-0">
                    <a href="{% url 'student:study_room' file.pk %}" class="btn btn-sm btn-primary" title="غرفة الدراسة"><i class="bi bi-play-fill me-1"></i><span class="d-none d-sm-inline">فتح</span></a>
                    <a href="{% url 'courses:file_download' file.pk %}" class="btn btn-sm btn-outline-secondary" title="تحميل"><i class="bi bi-download"></i></a>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>
{% endif %}
{% endfor %}

<!-- All Files (Fallback) -->
{% if all_files %}
<div class="card">
    <div class="card-header bg-transparent py-3"><h6 class="mb-0 fw-bold"><i class="bi bi-files me-2"></i>جميع الملفات ({{ all_files.count }})</h6></div>
    <div class="list-group list-group-flush">
        {% for file in all_files %}
        <div class="list-group-item py-3">
            <div class="d-flex justify-content-between align-items-center gap-2">
                <div class="d-flex align-items-center gap-2 min-w-0">
                    <i class="bi {% if file.is_pdf %}bi-file-earmark-pdf text-danger{% elif file.is_video %}bi-play-circle text-primary{% elif file.is_image %}bi-file-earmark-image text-success{% else %}bi-file-earmark text-secondary{% endif %} flex-shrink-0 fs-5"></i>
                    <div class="min-w-0">
                        <strong class="text-truncate d-block" style="font-size:0.9rem;">{{ file.title|truncatechars:40 }}</strong>
                        <div class="d-flex gap-2 align-items-center">
                            <span class="badge bg-light text-dark" style="font-size:0.65rem;">{{ file.get_file_type_display }}</span>
                            <small class="text-muted">{{ file.upload_date|date:"Y/m/d" }}</small>
                        </div>
                    </div>
                </div>
                <div class="d-flex gap-1 flex-shrink-0">
                    <a href="{% url 'student:study_room' file.pk %}" class="btn btn-sm btn-primary" title="غرفة الدراسة"><i class="bi bi-play-fill me-1"></i><span class="d-none d-sm-inline">فتح</span></a>
                    <a href="{% url 'courses:file_download' file.pk %}" class="btn btn-sm btn-outline-secondary" title="تحميل"><i class="bi bi-download"></i></a>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>
{% else %}
<div class="card"><div class="card-body empty-state"><i class="bi bi-files d-block"></i><p>لا توجد ملفات في هذا المقرر بعد</p></div></div>
{% endif %}
{% endblock %}
